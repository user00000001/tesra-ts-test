module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t){e.exports=require("tesra-ts-crypto")},function(e,t){e.exports=require("long")},function(e,t){e.exports=require("cross-fetch")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("bignumber.js")},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r(2),a=r.n(i);var o=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return n.code=e,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),t}(),s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://smartxcompiler.tesra.me/api/v1.0/csharp/compile";u(this,e),this.url=t}var t,r;return s(e,[{key:"compile",value:(t=regeneratorRuntime.mark((function e(t){var r,n,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={type:"CSharp",code:t.toString("utf-8")},e.next=3,a()(this.url,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}});case 3:return n=e.sent,e.next=6,n.json();case 6:if(0===(i=e.sent).errcode){e.next=9;break}throw new o(i.errcode,i.errdetail);case 9:return s=i.avm,u=i.abi,s.startsWith("b'")&&(s=s.substring(2,s.lastIndexOf("'"))),u.startsWith("b'")&&(u=(u=u.substring(2,u.lastIndexOf("'"))).replace(/\\n/g,"\n")),e.abrupt("return",{avm:new Buffer(s,"hex"),abi:new Buffer(u),hash:JSON.parse(u).hash});case 14:case"end":return e.stop()}}),e,this)})),r=function(){var e=t.apply(this,arguments);return new Promise((function(t,r){return function n(i,a){try{var o=e[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(s)}("next")}))},function(e){return r.apply(this,arguments)})}]),e}(),f=r(3),l=r(1);var d=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.items=t},p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function v(e){return new Promise((function(t){return setTimeout(t,e)}))}function y(e){return Object(f.readFileSync)(e)}function g(e){var t=Object(f.readFileSync)(e).toString();return new Buffer(t,"hex")}function w(e){for(var t=Buffer.allocUnsafe(e.length),r=0,n=e.length-1;r<=n;++r,--n)t[r]=e[n],t[n]=e[r];return t}function m(e){var t=new Buffer(e,"hex");return n.Serialize.bigIntFromBytes(t).toJSNumber()}function b(e,t){if("boolean"==typeof e)t.pushBool(e),t.writeOpCode(n.OpCode.PUSH0),t.writeOpCode(n.OpCode.BOOLOR);else if("number"==typeof e)t.pushNum(e),t.writeOpCode(n.OpCode.PUSH0),t.writeOpCode(n.OpCode.ADD);else if(e instanceof l)t.pushNum(e),t.writeOpCode(n.OpCode.PUSH0),t.writeOpCode(n.OpCode.ADD);else if("string"==typeof e)t.pushBytes(new Buffer(e));else if(e instanceof Buffer)t.pushBytes(e);else if(e instanceof n.Address)t.pushBytes(e.toArray());else if(e instanceof Map)k(e,t);else if(e instanceof d)!function(e,t){t.pushNum(0),t.writeOpCode(n.OpCode.NEWSTRUCT),t.writeOpCode(n.OpCode.TOALTSTACK),e.items.reverse().forEach((function(e){b(e,t),t.writeOpCode(n.OpCode.DUPFROMALTSTACK),t.writeOpCode(n.OpCode.SWAP),t.writeOpCode(n.OpCode.APPEND)})),t.writeOpCode(n.OpCode.FROMALTSTACK)}(e,t);else if(Array.isArray(e))!function(e,t){e.reverse().forEach((function(e){return b(e,t)})),t.pushNum(e.length),t.writeOpCode(n.OpCode.PACK)}(e,t);else{if("object"!==(void 0===e?"undefined":h(e)))throw new Error("Unsupported param type");k(new Map(Object.entries(e)),t)}}function k(e,t){t.writeOpCode(n.OpCode.NEWMAP),t.writeOpCode(n.OpCode.TOALTSTACK),Array.from(e.entries()).reverse().forEach((function(e){var r=p(e,2),i=r[0],a=r[1];t.writeOpCode(n.OpCode.DUPFROMALTSTACK),b(i,t),b(a,t),t.writeOpCode(n.OpCode.SETITEM)})),t.writeOpCode(n.OpCode.FROMALTSTACK)}var x=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://smartxcompiler.tesra.me/api/beta/python/compile";C(this,e),this.url=t}var t,r;return x(e,[{key:"compile",value:(t=regeneratorRuntime.mark((function e(t){var r,i,s,u,c,f,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={type:"Python",code:t.toString("utf-8")},e.next=3,a()(this.url,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}});case 3:return i=e.sent,e.next=6,i.json();case 6:if(0===(s=e.sent).errcode){e.next=9;break}throw new o(s.errcode,s.errdetail);case 9:u=s.avm,c=s.abi,u.startsWith("b'")&&(u=u.substring(2,u.lastIndexOf("'"))),f=w(n.Address.fromVmCode(new Buffer(u,"hex")).toArray()).toString("hex"),l=void 0,d=void 0;try{void 0!==s.debug&&(l=JSON.parse(s.debug)),void 0!==s.funcmap&&(d=JSON.parse(s.funcmap))}catch(e){console.warn("Failed to parse debug and funcmap from compiler")}return e.abrupt("return",{avm:new Buffer(u,"hex"),abi:new Buffer(c),hash:f,debug:l,funcMap:d});case 17:case"end":return e.stop()}}),e,this)})),r=function(){var e=t.apply(this,arguments);return new Promise((function(t,r){return function n(i,a){try{var o=e[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(s)}("next")}))},function(e){return r.apply(this,arguments)})}]),e}();var S=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{code:new Buffer(""),needStorage:!1,name:"",version:"",author:"",email:"",description:""};P(this,e),this.code=t.code,this.needStorage=t.needStorage,this.name=t.name,this.version=t.version,this.author=t.author,this.email=t.email,this.description=t.description}return S(e,[{key:"serialize",value:function(e){e.writeVarBytes(this.code),e.writeUint8(this.needStorage?1:0),e.writeString(this.name),e.writeString(this.version),e.writeString(this.author),e.writeString(this.email),e.writeString(this.description)}},{key:"deserialize",value:function(e){this.code=e.readVarBytes(),this.needStorage=1===e.readByte(),this.name=e.readVarString(),this.version=e.readVarString(),this.author=e.readVarString(),this.email=e.readVarString(),this.description=e.readVarString()}},{key:"toArray",value:function(){var e=new n.Writer;return this.serialize(e),new Buffer(e.getBytes())}},{key:"getCode",value:function(){return this.code}}]),e}();var R=r(4),T=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return T(e,[{key:"toArray",value:function(){var e=new n.Writer;return this.serialize(e),new Buffer(e.getBytes())}},{key:"serialize",value:function(e){e.writeBytes(this.value)}},{key:"deserialize",value:function(e){try{this.value=e.readBytes(32)}catch(e){throw new Error("deserialize Uint256 error")}}}],[{key:"parseFromBytes",value:function(t){var r=new n.Reader(t),i=new e;return i.deserialize(r),i}}]),e}(),E=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Buffer("");j(this,e),this.code=t}return E(e,[{key:"serialize",value:function(e){try{e.writeVarBytes(this.code)}catch(e){throw new Error("InvokeCode Code Serialize failed: "+e)}}},{key:"deserialize",value:function(e){try{var t=e.readVarBytes();this.code=t}catch(e){throw new Error("InvokeCode Code Deserialize failed: "+e)}}}]),e}(),q=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function U(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var N=function(){function e(t,r){L(this,e),this.invoke=t,this.verify=r}return q(e,[{key:"getVerify",value:function(){return this.verify}},{key:"serialize",value:function(e){e.writeVarBytes(this.invoke),e.writeVarBytes(this.verify)}}],[{key:"deserialize",value:function(t){return new e(t.readVarBytes(),t.readVarBytes())}}]),e}(),V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.version,i=void 0===r?0:r,a=t.txType,o=void 0===a?209:a,s=t.nonce,u=void 0===s?l.fromBytes([].concat(U(Object(R.randomBytes)(4))),!0,!0).toNumber():s,c=t.gasPrice,f=void 0===c?l.fromNumber(500):c,d=t.gasLimit,p=void 0===d?l.fromNumber(3e4):d,h=t.payer,v=void 0===h?new n.Address("0000000000000000000000000000000000000000"):h,y=t.payload,g=void 0===y?new z:y,w=t.sigs,m=void 0===w?[]:w;L(this,e),this.version=i,this.txType=o,this.nonce=u,this.gasPrice=f,this.gasLimit=p,this.payer=v,this.payload=g,this.sigs=m,this.hash=A.parseFromBytes(n.Hash.sha256(this.serializeUnsigned()))}return q(e,[{key:"getVersion",value:function(){return this.version}},{key:"getNonce",value:function(){return this.nonce}},{key:"getGasPrice",value:function(){return this.gasPrice}},{key:"getGasLimit",value:function(){return this.gasLimit}},{key:"getHash",value:function(){return this.hash}},{key:"getTxType",value:function(){return this.txType}},{key:"getPayer",value:function(){return this.payer}},{key:"setPayer",value:function(e){this.payer=e}},{key:"getPayload",value:function(){return this.payload}},{key:"addSig",value:function(e){this.sigs.push(e)}},{key:"getSignatureAddresses",value:function(){var e=[],t=!0,r=!1,i=void 0;try{for(var a,o=this.sigs[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;e.push(n.Address.fromVmCode(s.getVerify()))}}catch(e){r=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw i}}return e}},{key:"serialize",value:function(e){if(void 0!==this.raw){if(0===this.raw.length)throw new Error("wrong constructed transaction");e.writeBytes(this.raw)}else e.writeBytes(this.serializeUnsigned()),e.writeBytes(this.serializeSigned())}},{key:"deserialize",value:function(e){var t=e.position();this.deserializeUnsigned(e);var r=e.position()-t;e.seek(-r,"relative");var n=e.readBytes(r),i=Object(R.createHash)("sha256");i.update(n),this.hash=A.parseFromBytes(i.digest());var a=e.readVarUInt().toNumber();if(a>16)throw new Error("transaction signature number "+a+" execced 16");for(var o=0;o<a;o++){var s=N.deserialize(e);this.sigs.push(s)}var u=e.position()-t;e.seek(-u,"relative"),this.raw=e.readBytes(u)}},{key:"toArray",value:function(){var e=new n.Writer;return this.serialize(e),new Buffer(e.getBytes())}},{key:"serializeUnsigned",value:function(){var e=new n.Writer;return e.writeUint8(this.version),e.writeUint8(this.txType),e.writeUint32(this.nonce),e.writeUint64(this.gasPrice),e.writeUint64(this.gasLimit),this.payer.serialize(e),this.payload.serialize(e),e.writeVarUint(0),e.getBytes()}},{key:"deserializeUnsigned",value:function(e){if(this.version=e.readByte(),this.txType=e.readByte(),this.nonce=e.readUInt32(),this.gasPrice=e.readUInt64(),this.gasLimit=e.readUInt64(),this.payer=n.Address.deserialize(e.readBytes(20)),209===this.txType){var t=new z;t.deserialize(e),this.payload=t}else{if(208!==this.txType)throw new Error("unsupported tx type "+this.getTxType());var r=new B;r.deserialize(e),this.payload=r}if(!e.readVarUInt().isZero())throw new Error("transaction attribute must be 0, got %d")}},{key:"serializeSigned",value:function(){var e=new n.Writer;e.writeVarUint(this.sigs.length);for(var t=0;t<this.sigs.length;t++)this.sigs[t].serialize(e);return e.getBytes()}}]),e}(),F=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var I=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http://dapp2.tesra.me:25768";W(this,e),this.url=t}return F(e,[{key:"getUrl",value:function(){return this.url}},{key:"makeRequest",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i={jsonrpc:"2.0",method:e,params:r,id:1};return i}},{key:"sendRequest",value:function(e){return a()(this.url,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}))}},{key:"getBalance",value:function(e){var t=this.makeRequest("getbalance",e.toBase58());return this.sendRequest(t)}},{key:"getUnboundTsg",value:function(e){var t=this.makeRequest("getunboundtsg",e.toBase58());return this.sendRequest(t)}},{key:"sendRawTransaction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=void 0;return e instanceof Buffer&&(e=e.toString("hex")),r=t?this.makeRequest("sendrawtransaction",e,1):this.makeRequest("sendrawtransaction",e),this.sendRequest(r)}},{key:"getRawTransaction",value:function(e){var t=this.makeRequest("getrawtransaction",e);return this.sendRequest(t)}},{key:"getRawTransactionJson",value:function(e){var t=this.makeRequest("getrawtransaction",e,1);return this.sendRequest(t)}},{key:"getNodeCount",value:function(){var e=this.makeRequest("getconnectioncount");return this.sendRequest(e)}},{key:"getBlockHeight",value:function(){var e=this.makeRequest("getblockcount");return this.sendRequest(e)}},{key:"getBlockCount",value:function(){var e=this.makeRequest("getblockcount");return this.sendRequest(e)}},{key:"getBlockJson",value:function(e){var t=this.makeRequest("getblock",e,1);return this.sendRequest(t)}},{key:"getContract",value:function(e){var t=this.makeRequest("getcontractstate",e);return this.sendRequest(t)}},{key:"getContractJson",value:function(e){var t=this.makeRequest("getcontractstate",e,1);return this.sendRequest(t)}},{key:"getBlock",value:function(e){var t=this.makeRequest("getblock",e);return this.sendRequest(t)}},{key:"getSmartCodeEvent",value:function(e){var t=this.makeRequest("getsmartcodeevent",e);return this.sendRequest(t)}},{key:"getBlockHeightByTxHash",value:function(e){var t=this.makeRequest("getblockheightbytxhash",e);return this.sendRequest(t)}},{key:"getStorage",value:function(e,t){var r=this.makeRequest("getstorage",e,t);return this.sendRequest(r)}},{key:"getMerkleProof",value:function(e){var t=this.makeRequest("getmerkleproof",e);return this.sendRequest(t)}},{key:"getAllowance",value:function(e,t,r){var n=this.makeRequest("getallowance",e,t.toBase58(),r.toBase58());return this.sendRequest(n)}}]),e}(),M=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function H(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(i,a){try{var o=t[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}var K=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rpcAddress=t}var t,r;return M(e,[{key:"isDeployed",value:(r=H(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new I(this.rpcAddress),e.next=3,r.getContract(t.toArray().toString("hex"));case 3:if("unknow contract"!==(n=e.sent).result&&"unknow contracts"!==n.result){e.next=8;break}return e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"deploy",value:(t=H(regeneratorRuntime.mark((function e(t){var r,i,a,o,s,u,c=t.code,f=t.needStorage,d=void 0!==f&&f,p=t.name,h=void 0===p?"":p,y=t.version,g=void 0===y?"":y,w=t.author,m=void 0===w?"":w,b=t.email,k=void 0===b?"":b,x=t.description,C=void 0===x?"":x,O=t.gasPrice,S=void 0===O?"500":O,P=t.gasLimit,R=void 0===P?"20000000":P,T=t.processCallback;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new B({code:c,needStorage:d,name:h,version:g,author:m,email:k,description:C}),i=new V({txType:208,payload:r,gasPrice:l.fromString(S),gasLimit:l.fromString(R)}),void 0===T){e.next=7;break}if(!((a=T(i))instanceof Promise)){e.next=7;break}return e.next=7,a;case 7:return o=new I(this.rpcAddress),s=new n.Writer,i.serialize(s),e.next=12,o.sendRawTransaction(s.getBytes(),!1);case 12:if(0===(u=e.sent).error){e.next=15;break}throw new Error("Failed to deploy contract: "+u.error+" - "+u.result);case 15:return e.next=17,v(3e3);case 17:return e.next=19,o.getSmartCodeEvent(u.result);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),_=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function D(e,t,r){var i=new n.ProgramBuilder;return(r=[t,r]).reverse().forEach((function(e){return b(e,i)})),i.writeOpCode(n.OpCode.APPCALL),i.writeBytes(w(new Buffer(e,"hex"))),i.getProgram()}var J=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rpcAddress=t}var t,r;return _(e,[{key:"invoke",value:(t=regeneratorRuntime.mark((function e(t){var r,i,a,o,s,u,c,f,d=t.method,p=t.parameters,h=void 0===p?[]:p,y=t.contract,g=t.gasPrice,w=void 0===g?"500":g,m=t.gasLimit,b=void 0===m?"20000000":m,k=t.preExec,x=t.processCallback,C=t.wait,O=void 0===C||C,S=t.debug,P=void 0!==S&&S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P&&console.info("Preparing smart contract call "+d+"..."),r=new z(D(y,d,h)),P&&(i=new n.Writer,r.serialize(i),console.log("Payload is: "+i.getBytes().toString("hex"))),a=new V({txType:209,payload:r,gasPrice:l.fromString(w),gasLimit:l.fromString(b)}),P&&(o=new n.Writer,a.serialize(o),console.log("Unsigned TX is: "+o.getBytes().toString("hex"))),void 0===x){e.next=10;break}if(!((s=x(a))instanceof Promise)){e.next=10;break}return e.next=10,s;case 10:return u=new I(this.rpcAddress),c=new n.Writer,a.serialize(c),e.next=15,u.sendRawTransaction(c.getBytes(),k);case 15:if(0===(f=e.sent).error){e.next=18;break}throw new Error("Failed to invoke contract: "+f.result);case 18:if(!k&&O){e.next=20;break}return e.abrupt("return",f);case 20:return e.next=22,v(3e3);case 22:return e.next=24,u.getSmartCodeEvent(f.result);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e,this)})),r=function(){var e=t.apply(this,arguments);return new Promise((function(t,r){return function n(i,a){try{var o=e[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(s)}("next")}))},function(e){return r.apply(this,arguments)})}]),e}(),G=r(5),Y=r.n(G),X=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function Z(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(i,a){try{var o=t[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}var Q=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rpcAddress=t}var t,r;return X(e,[{key:"transfer",value:(r=Z(regeneratorRuntime.mark((function e(t){var r,i,a,o,s,u,c,f,p,h,y=t.sender,g=t.to,w=t.amount,m=t.asset,k=t.gasPrice,x=void 0===k?"500":k,C=t.gasLimit,O=void 0===C?"20000000":C,S=t.processCallback,P=t.wait,B=void 0===P||P;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Y.a(w),"tsg"===m&&(r=r.shiftedBy(9)),i=new n.ProgramBuilder,a=new d([y,g,l.fromString(r.toString())].reverse()),[0,new n.Address(this.getContract(m)),"transfer",[a]].reverse().forEach((function(e){return b(e,i)})),i.writeOpCode(n.OpCode.SYSCALL),i.pushBytes(new Buffer("Tesra.Native.Invoke")),o=i.getProgram(),s=new z(o),u=new V({txType:209,payload:s,gasPrice:l.fromString(x),gasLimit:l.fromString(O)}),void 0===S){e.next=16;break}if(!((c=S(u))instanceof Promise)){e.next=16;break}return e.next=16,c;case 16:return f=new I(this.rpcAddress),p=new n.Writer,u.serialize(p),e.next=21,f.sendRawTransaction(p.getBytes(),!1);case 21:if(0===(h=e.sent).error){e.next=24;break}throw new Error("Failed to make the transfer: "+h.error+" - "+h.result);case 24:if(B){e.next=26;break}return e.abrupt("return",h);case 26:return e.next=28,v(3e3);case 28:return e.next=30,f.getSmartCodeEvent(h.result);case 30:return e.abrupt("return",e.sent);case 31:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"withdrawTsg",value:(t=Z(regeneratorRuntime.mark((function e(t){var r,i,a,o,s,u,c,f,p,h,y=t.sender,g=t.to,w=t.amount,m=t.gasPrice,k=void 0===m?"500":m,x=t.gasLimit,C=void 0===x?"20000000":x,O=t.processCallback,S=t.wait,P=void 0===S||S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Y.a(w).shiftedBy(9),i=new n.ProgramBuilder,a=new d([y,new n.Address(this.getContract("tst")),g,l.fromString(r.toString())].reverse()),[0,new n.Address(this.getContract("tsg")),"transferFrom",a].reverse().forEach((function(e){return b(e,i)})),i.writeOpCode(n.OpCode.SYSCALL),i.pushBytes(new Buffer("Tesra.Native.Invoke")),o=i.getProgram(),s=new z(o),u=new V({txType:209,payload:s,gasPrice:l.fromString(k),gasLimit:l.fromString(C)}),void 0===O){e.next=15;break}if(!((c=O(u))instanceof Promise)){e.next=15;break}return e.next=15,c;case 15:return f=new I(this.rpcAddress),p=new n.Writer,u.serialize(p),e.next=20,f.sendRawTransaction(p.getBytes(),!1);case 20:if(0===(h=e.sent).error){e.next=23;break}throw new Error("Failed to make the withdraw Tsg: "+h.error+" - "+h.result);case 23:if(P){e.next=25;break}return e.abrupt("return",h);case 25:return e.next=27,v(3e3);case 27:return e.next=29,f.getSmartCodeEvent(h.result);case 29:return e.abrupt("return",e.sent);case 30:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getContract",value:function(e){if("tst"===e)return"0000000000000000000000000000000000000001";if("tsg"===e)return"0000000000000000000000000000000000000002";throw new Error("Invalid asset: "+e+".")}}]),e}();function $(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(i,a){try{var o=t[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}function ee(e){var t=f.readFileSync(e,"utf8");return n.Wallet.deserializeJson(t)}function te(e){var t=n.Wallet.create();return e.forEach((function(e){return t.addAccount(e)})),t}function re(e){return n.Account.create(Object(R.randomBytes)(4).toString("hex"),n.PrivateKey.deserialize(new Buffer(e,"hex")),"")}var ne,ie,ae=(ne=$(regeneratorRuntime.mark((function e(t,r,i){var a,o,s,u,c,f,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.serializeUnsigned(),o=n.Hash.sha256(n.Hash.sha256(a)),e.next=4,r.decryptKey(i);case 4:return s=e.sent,u=s.getPublicKey(),e.next=8,s.sign(o);case 8:c=e.sent,f=Object(n.programFromParams)([c.serialize()]),l=Object(n.programFromPubKey)(u),d=new N(f,l),t.addSig(d);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return ne.apply(this,arguments)}),oe=(ie=$(regeneratorRuntime.mark((function e(t,r,i){var a,o,s,u,c,f,l,d,p,h,v,y,g,w,m,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.serializeUnsigned(),o=n.Hash.sha256(n.Hash.sha256(a)),s=[],u=[],c=!0,f=!1,l=void 0,e.prev=7,d=i[Symbol.iterator]();case 9:if(c=(p=d.next()).done){e.next=23;break}return h=p.value,e.next=13,h.account.decryptKey(h.password);case 13:return v=e.sent,y=v.getPublicKey(),e.next=17,v.sign(o);case 17:g=e.sent,u.push(y),s.push(g.serialize());case 20:c=!0,e.next=9;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),f=!0,l=e.t0;case 29:e.prev=29,e.prev=30,!c&&d.return&&d.return();case 32:if(e.prev=32,!f){e.next=35;break}throw l;case 35:return e.finish(32);case 36:return e.finish(29);case 37:w=Object(n.programFromParams)(s),m=Object(n.programFromMultiPubKeys)(r,u),b=new N(w,m),t.addSig(b);case 41:case"end":return e.stop()}}),e,this,[[7,25,29,37],[30,,32,36]])}))),function(e,t,r){return ie.apply(this,arguments)});r.d(t,"initClient",(function(){return fe})),r.d(t,"compile",(function(){return le})),r.d(t,"deploy",(function(){return de})),r.d(t,"isDeployed",(function(){return pe})),r.d(t,"invoke",(function(){return he})),r.d(t,"transfer",(function(){return ve})),r.d(t,"withdrawTsg",(function(){return ye})),r.d(t,"loadContract",(function(){return y})),r.d(t,"loadCompiledContract",(function(){return g})),r.d(t,"loadWallet",(function(){return ee})),r.d(t,"createWallet",(function(){return te})),r.d(t,"createAccount",(function(){return re})),r.d(t,"hex2num",(function(){return m})),r.d(t,"reverseBuffer",(function(){return w})),r.d(t,"RpcClient",(function(){return I})),r.d(t,"buildInvokePayload",(function(){return D})),r.d(t,"InvokeCode",(function(){return z})),r.d(t,"DeployCode",(function(){return B})),r.d(t,"Transaction",(function(){return V}));var se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function ue(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,r){return function n(i,a){try{var o=t[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}function ce(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function fe(e){var t=e.rpcAddress;return{rpcAddress:void 0===t?"http://dapp2.tesra.me:25768":t}}function le(e){var t=e.code;return function(e){var t=e.type,r=e.url;switch(t){case"Python":return new O(r);case"CSharp":return new c(r);default:throw new Error("Unsupported compiler")}}({type:e.type,url:e.url}).compile(t)}function de(e){var t,r=this,n=e.client,i=e.account,a=e.password,o=ce(e,["client","account","password"]);return new K(n.rpcAddress).deploy(se({},o,{processCallback:(t=ue(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setPayer(i.address),e.next=3,ae(t,i,void 0!==a?a:"");case 3:case"end":return e.stop()}}),e,r)}))),function(e){return t.apply(this,arguments)})}))}function pe(e){var t=e.client,r=e.scriptHash;return new K(t.rpcAddress).isDeployed(new n.Address(r))}function he(e){var t,r=this,n=e.client,i=e.account,a=e.password,o=e.signers,s=ce(e,["client","account","password","signers"]);return new J(n.rpcAddress).invoke(se({},s,{processCallback:(t=ue(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i){e.next=4;break}return t.setPayer(i.address),e.next=4,ae(t,i,void 0!==a?a:"");case 4:if(void 0===o){e.next=7;break}return e.next=7,oe(t,o.length,o);case 7:case"end":return e.stop()}}),e,r)}))),function(e){return t.apply(this,arguments)})}))}function ve(e){var t,r=this,n=e.client,i=e.account,a=e.password,o=ce(e,["client","account","password"]);return new Q(n.rpcAddress).transfer(se({},o,{processCallback:(t=ue(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i){e.next=4;break}return t.setPayer(i.address),e.next=4,ae(t,i,void 0!==a?a:"");case 4:case"end":return e.stop()}}),e,r)}))),function(e){return t.apply(this,arguments)})}))}function ye(e){var t,r=this,n=e.client,i=e.account,a=e.password,o=ce(e,["client","account","password"]);return new Q(n.rpcAddress).withdrawTsg(se({},o,{processCallback:(t=ue(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i){e.next=4;break}return t.setPayer(i.address),e.next=4,ae(t,i,void 0!==a?a:"");case 4:case"end":return e.stop()}}),e,r)}))),function(e){return t.apply(this,arguments)})}))}}]);
//# sourceMappingURL=index.js.map